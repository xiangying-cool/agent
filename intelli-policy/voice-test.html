<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯­éŸ³è¯†åˆ«æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
        }
        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: bold;
        }
        .status.ready {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .status.listening {
            background: #fff3cd;
            color: #856404;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        button {
            width: 100%;
            padding: 20px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 0;
        }
        #startBtn {
            background: #28a745;
            color: white;
        }
        #startBtn:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        #startBtn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        #stopBtn {
            background: #dc3545;
            color: white;
        }
        #stopBtn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        #result {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            min-height: 100px;
            margin: 20px 0;
            font-size: 16px;
            line-height: 1.6;
        }
        .log {
            background: #212529;
            color: #00ff00;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .log-entry {
            margin: 5px 0;
        }
        .mic-icon {
            font-size: 48px;
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ è¯­éŸ³è¯†åˆ«æµ‹è¯•å·¥å…·</h1>
        
        <div id="status" class="status ready">
            âœ… ç³»ç»Ÿå°±ç»ªï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•
        </div>

        <div class="mic-icon" id="micIcon">ğŸ™ï¸</div>

        <button id="startBtn">ğŸ¤ å¼€å§‹å½•éŸ³</button>
        <button id="stopBtn" style="display:none;">â¹ï¸ åœæ­¢å½•éŸ³</button>

        <div id="result">
            <strong>è¯†åˆ«ç»“æœï¼š</strong><br>
            <span id="transcript" style="color: #667eea; font-size: 20px;">ç­‰å¾…è¯­éŸ³è¾“å…¥...</span>
        </div>

        <div class="log" id="log">
            <div class="log-entry">æ§åˆ¶å°æ—¥å¿—ï¼š</div>
        </div>
    </div>

    <script>
        const statusDiv = document.getElementById('status');
        const micIcon = document.getElementById('micIcon');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const transcript = document.getElementById('transcript');
        const logDiv = document.getElementById('log');

        let recognition = null;

        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function updateStatus(text, className) {
            statusDiv.textContent = text;
            statusDiv.className = 'status ' + className;
        }

        // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

        if (!SpeechRecognition) {
            updateStatus('âŒ æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ Web Speech APIï¼Œè¯·ä½¿ç”¨ Chrome æˆ– Edge', 'error');
            startBtn.disabled = true;
            log('æµè§ˆå™¨ä¸æ”¯æŒ Web Speech API', 'error');
        } else {
            log('âœ… æµè§ˆå™¨æ”¯æŒ Web Speech API');
            
            // åˆå§‹åŒ–è¯­éŸ³è¯†åˆ«
            recognition = new SpeechRecognition();
            recognition.continuous = false;  // å•æ¬¡è¯†åˆ«æ¨¡å¼
            recognition.interimResults = true;  // å¼€å¯ä¸­é—´ç»“æœï¼Œå®æ—¶æ˜¾ç¤º
            recognition.lang = 'zh-CN';  // ä¸­æ–‡è¯†åˆ«
            recognition.maxAlternatives = 1;  // åªè¿”å›æœ€ä½³ç»“æœ
            
            log(`é…ç½®ï¼šcontinuous=false, interimResults=false, lang=zh-CN`);

            recognition.onstart = () => {
                log('âœ… è¯­éŸ³è¯†åˆ«å·²å¯åŠ¨');
                updateStatus('ğŸ¤ æ­£åœ¨å½•éŸ³...è¯·å¼€å§‹è¯´è¯', 'listening');
                micIcon.textContent = 'ğŸ”´';
                startBtn.style.display = 'none';
                stopBtn.style.display = 'block';
            };

            recognition.onresult = (event) => {
                log(`âœ… æ”¶åˆ°è¯†åˆ«ç»“æœ (isFinal: ${event.results[0].isFinal})`);
                
                const result = event.results[0][0];
                const text = result.transcript;
                const confidence = (result.confidence * 100).toFixed(2);
                const isFinal = event.results[0].isFinal;
                
                log(`è¯†åˆ«æ–‡æœ¬: "${text}"`);
                log(`ç½®ä¿¡åº¦: ${confidence}%`);
                log(`æ˜¯å¦æœ€ç»ˆç»“æœ: ${isFinal}`);
                
                // æ˜¾ç¤ºä¸­é—´ç»“æœå’Œæœ€ç»ˆç»“æœ
                if (isFinal) {
                    transcript.textContent = text;
                    updateStatus(`âœ… è¯†åˆ«æˆåŠŸï¼ç½®ä¿¡åº¦: ${confidence}%`, 'ready');
                } else {
                    transcript.textContent = text + ' (è¯†åˆ«ä¸­...)';
                    updateStatus(`â³ æ­£åœ¨è¯†åˆ«...`, 'listening');
                }
            };

            recognition.onerror = (event) => {
                log(`âŒ é”™è¯¯: ${event.error}`, 'error');
                updateStatus(`âŒ é”™è¯¯: ${event.error}`, 'error');
                micIcon.textContent = 'ğŸ™ï¸';
                startBtn.style.display = 'block';
                stopBtn.style.display = 'none';
                
                // è¯¦ç»†é”™è¯¯è¯´æ˜
                const errorMessages = {
                    'no-speech': 'æ²¡æœ‰æ£€æµ‹åˆ°è¯­éŸ³ï¼Œè¯·é‡è¯•',
                    'audio-capture': 'æ— æ³•è®¿é—®éº¦å…‹é£ï¼Œè¯·æ£€æŸ¥æƒé™',
                    'not-allowed': 'éº¦å…‹é£æƒé™è¢«æ‹’ç»',
                    'network': 'ç½‘ç»œé”™è¯¯',
                    'aborted': 'è¯†åˆ«è¢«ä¸­æ­¢'
                };
                
                if (errorMessages[event.error]) {
                    alert(errorMessages[event.error]);
                }
            };

            recognition.onend = () => {
                log('âœ… è¯­éŸ³è¯†åˆ«å·²ç»“æŸ');
                micIcon.textContent = 'ğŸ™ï¸';
                startBtn.style.display = 'block';
                stopBtn.style.display = 'none';
                
                if (statusDiv.className.includes('listening')) {
                    updateStatus('âš ï¸ å½•éŸ³ç»“æŸï¼Œä½†æœªè¯†åˆ«åˆ°æ–‡å­—', 'error');
                }
            };
        }

        startBtn.addEventListener('click', () => {
            if (!recognition) return;
            
            log('ğŸ¤ ç”¨æˆ·ç‚¹å‡»å¼€å§‹å½•éŸ³');
            try {
                recognition.start();
            } catch (e) {
                log(`âŒ å¯åŠ¨å¤±è´¥: ${e.message}`, 'error');
                alert(`å¯åŠ¨å¤±è´¥: ${e.message}`);
            }
        });

        stopBtn.addEventListener('click', () => {
            if (!recognition) return;
            
            log('â¹ï¸ ç”¨æˆ·ç‚¹å‡»åœæ­¢å½•éŸ³');
            try {
                recognition.stop();
            } catch (e) {
                log(`âŒ åœæ­¢å¤±è´¥: ${e.message}`, 'error');
            }
        });

        log('é¡µé¢åŠ è½½å®Œæˆï¼Œç­‰å¾…ç”¨æˆ·æ“ä½œ');
    </script>
</body>
</html>
