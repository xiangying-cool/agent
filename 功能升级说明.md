# åŠŸèƒ½å‡çº§è¯´æ˜ ğŸš€

## âœ… å·²å®Œæˆçš„ä¸‰å¤§åŠŸèƒ½

### 1. æ’ä»¶ç³»ç»Ÿé›†æˆ ğŸ”Œ

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- åŠ¨æ€æ’ä»¶åŠ è½½æœºåˆ¶
- Agent è‡ªåŠ¨è°ƒç”¨æ’ä»¶
- ä»·æ ¼æ¯”è¾ƒæ’ä»¶ï¼ˆå¯¹æ¥ç”µå•†APIï¼‰
- æŠ¥å‘Šç”Ÿæˆæ’ä»¶ï¼ˆPDF/Excelï¼‰

**æ–‡ä»¶ä¿®æ”¹ï¼š**
- âœ… [`agent.py`](file:///e:/shensibeiai/agent.py) - é›†æˆæ’ä»¶ç®¡ç†å™¨
  - åœ¨åˆå§‹åŒ–æ—¶åŠ è½½æ‰€æœ‰æ’ä»¶
  - æ¨èç®—æ³•è°ƒç”¨ä»·æ ¼æ¯”è¾ƒæ’ä»¶
  - è¿”å›ä»·æ ¼å¯¹æ¯”æ•°æ®åˆ°å‰ç«¯

**ä½¿ç”¨æ–¹å¼ï¼š**
```python
# æ™ºèƒ½ä½“è‡ªåŠ¨è°ƒç”¨æ’ä»¶
result = agent.query("æˆ‘æœ‰20000å…ƒé¢„ç®—ï¼Œæ¨èæ¢æ–°æ–¹æ¡ˆ")
# result åŒ…å« price_comparison å­—æ®µ
```

**æ’ä»¶åˆ—è¡¨ï¼š**
- `price_comparator` - äº¬ä¸œ/æ·˜å®ä»·æ ¼å¯¹æ¯”
- `report_generator` - ç”ŸæˆPDF/ExcelæŠ¥å‘Š

---

### 2. æµå¼è¾“å‡ºï¼ˆSSEï¼‰âš¡

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- Server-Sent Events å®æ—¶æ¨é€
- æ‰“å­—æœºæ•ˆæœé€å­—æ˜¾ç¤º
- è¿›åº¦å®æ—¶åé¦ˆï¼ˆæ„å›¾è¯†åˆ« â†’ æ£€ç´¢ â†’ ç”Ÿæˆï¼‰
- å¼‚æ­¥å¤„ç†ä¸é˜»å¡ä¸»çº¿ç¨‹

**æ–‡ä»¶ä¿®æ”¹ï¼š**
- âœ… [`app.py`](file:///e:/shensibeiai/app.py) - æ–°å¢ `/api/stream_query` ç«¯ç‚¹
  - æ”¯æŒ SSE æµå¼ä¼ è¾“
  - 5 ä¸ªé˜¶æ®µè¿›åº¦æ¨é€
  - é€å­—å‘é€ç­”æ¡ˆï¼ˆchunk_size=10ï¼‰

**å‰ç«¯ä½¿ç”¨ç¤ºä¾‹ï¼š**
```javascript
const eventSource = new EventSource(
  `http://localhost:8000/api/stream_query?question=${encodeURIComponent(question)}`
);

eventSource.onmessage = (event) => {
  const data = JSON.parse(event.data);
  
  if (data.type === 'start') {
    console.log('å¼€å§‹å¤„ç†...');
  } else if (data.type === 'chunk') {
    // é€å­—æ˜¾ç¤º
    appendText(data.content);
  } else if (data.type === 'complete') {
    // å®Œæ•´ç»“æœ
    showResult(data.result);
  }
};
```

**æµ‹è¯•å‘½ä»¤ï¼š**
```bash
# ç›´æ¥è®¿é—®æµ‹è¯•
curl "http://localhost:8000/api/stream_query?question=æµå—å¸‚å®¶ç”µè¡¥è´´æ ‡å‡†"
```

---

### 3. å›¾è¡¨å¯è§†åŒ–ï¼ˆChart.jsï¼‰ğŸ“Š

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- è¡¥è´´å æ¯”é¥¼å›¾ï¼ˆPie Chartï¼‰
- ä»·æ ¼å¯¹æ¯”æŸ±çŠ¶å›¾ï¼ˆBar Chartï¼‰
- èµ„é‡‘åˆ©ç”¨ç‡æŠ˜çº¿å›¾ï¼ˆLine Chartï¼‰
- å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯

**æ–‡ä»¶ä¿®æ”¹ï¼š**
- âœ… [`intelli-policy/src/Charts.jsx`](file:///e:/shensibeiai/intelli-policy/src/Charts.jsx) - å›¾è¡¨ç»„ä»¶åº“
  - `SubsidyPieChart` - è¡¥è´´å æ¯”
  - `PriceComparisonChart` - ä»·æ ¼å¯¹æ¯”
  - `UtilizationChart` - èµ„é‡‘åˆ©ç”¨ç‡
  - `VisualizationPanel` - å®Œæ•´é¢æ¿

- âœ… [`intelli-policy/src/App.jsx`](file:///e:/shensibeiai/intelli-policy/src/App.jsx) - é›†æˆåˆ°è®¡ç®—å™¨æ¨¡å—
  - å¯¼å…¥ Chart ç»„ä»¶
  - ä¿å­˜ `recommendation` å’Œ `price_comparison` æ•°æ®
  - æ¸²æŸ“å¯è§†åŒ–é¢æ¿

- âœ… [`intelli-policy/package.json`](file:///e:/shensibeiai/intelli-policy/package.json) - æ–°å¢ä¾èµ–
  - `chart.js@^4.4.0`
  - `react-chartjs-2@^5.2.0`

**æ•ˆæœå±•ç¤ºï¼š**
```
æ™ºèƒ½æ¢æ–°è§„åˆ’å¸ˆ
â”œâ”€â”€ [é…ç½®é¢æ¿] é¢„ç®—æ»‘å— + å“ç±»é€‰æ‹©
â””â”€â”€ [ç»“æœé¢æ¿]
    â”œâ”€â”€ æ¨èç»„åˆæ¸…å•
    â”œâ”€â”€ ğŸ“Š ä»·æ ¼å¯¹æ¯”æŸ±çŠ¶å›¾ï¼ˆåŸä»· vs å®ä»˜ vs è¡¥è´´ï¼‰
    â”œâ”€â”€ ğŸ“Š è¡¥è´´å æ¯”é¥¼å›¾ï¼ˆå„äº§å“è¡¥è´´åˆ†å¸ƒï¼‰
    â””â”€â”€ ğŸ“Š èµ„é‡‘åˆ©ç”¨ç‡æŠ˜çº¿å›¾ï¼ˆé¢„ç®— â†’ èŠ±è´¹ â†’ è¡¥è´´åï¼‰
```

---

## ğŸ¯ å®Œæ•´ä½¿ç”¨æµç¨‹

### å¯åŠ¨é¡¹ç›®

```bash
# 1. å¯åŠ¨åç«¯ï¼ˆè‡ªåŠ¨åŠ è½½æ’ä»¶ï¼‰
cd e:\shensibeiai
python app.py

# è¾“å‡ºæ—¥å¿—ï¼š
# âœ“ æ’ä»¶å·²åŠ è½½: price_comparator v1.0.0
# âœ“ æ’ä»¶å·²åŠ è½½: report_generator v1.0.0
# æ™ºèƒ½ä½“åˆå§‹åŒ–å®Œæˆï¼

# 2. è®¿é—®å‰ç«¯
http://localhost:8000
```

### æµ‹è¯•åŠŸèƒ½

#### æµ‹è¯•1ï¼šæ’ä»¶ç³»ç»Ÿ
```python
# æé—®ï¼š"æˆ‘æœ‰20000å…ƒé¢„ç®—ï¼Œæ¨èå®¶ç”µæ¢æ–°æ–¹æ¡ˆ"
# åç«¯æ—¥å¿—ä¼šæ˜¾ç¤ºï¼š
# âœ“ ä»·æ ¼æ¯”è¾ƒæ’ä»¶è¿è¡ŒæˆåŠŸ: æ€»èŠ‚çœï¿¥300
```

#### æµ‹è¯•2ï¼šæµå¼è¾“å‡º
```bash
# æµè§ˆå™¨è®¿é—®
http://localhost:8000/api/stream_query?question=æµå—å¸‚è¡¥è´´æ ‡å‡†

# ç»ˆç«¯æµ‹è¯•
curl "http://localhost:8000/api/stream_query?question=æµ‹è¯•"
```

#### æµ‹è¯•3ï¼šå›¾è¡¨å¯è§†åŒ–
1. æ‰“å¼€ http://localhost:8000
2. åˆ‡æ¢åˆ°"æ™ºèƒ½è§„åˆ’å¸ˆ"æ ‡ç­¾
3. è°ƒæ•´é¢„ç®—æ»‘å—åˆ° Â¥20,000
4. ç‚¹å‡»"ç”Ÿæˆæœ€ä¼˜æ–¹æ¡ˆ"
5. æŸ¥çœ‹ä¸‰å¼ å›¾è¡¨ï¼š
   - ä»·æ ¼å¯¹æ¯”æŸ±çŠ¶å›¾
   - è¡¥è´´å æ¯”é¥¼å›¾
   - èµ„é‡‘åˆ©ç”¨ç‡æŠ˜çº¿å›¾

---

## ğŸ“¦ æ–°å¢æ–‡ä»¶æ¸…å•

```
e:/shensibeiai/
â”œâ”€â”€ plugin_manager.py          # æ’ä»¶ç®¡ç†å™¨æ ¸å¿ƒ
â”œâ”€â”€ plugins/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ price_comparator.py    # ä»·æ ¼æ¯”è¾ƒæ’ä»¶
â”‚   â””â”€â”€ report_generator.py    # æŠ¥å‘Šç”Ÿæˆæ’ä»¶
â”œâ”€â”€ intelli-policy/src/
â”‚   â””â”€â”€ Charts.jsx             # å›¾è¡¨ç»„ä»¶åº“
â”œâ”€â”€ test_plugins.py            # æ’ä»¶æµ‹è¯•è„šæœ¬
â”œâ”€â”€ æ™ºèƒ½ä½“å®Œå–„æ–¹æ¡ˆ.md          # å®Œæ•´æ”¹è¿›å»ºè®®
â””â”€â”€ åŠŸèƒ½å‡çº§è¯´æ˜.md            # æœ¬æ–‡æ¡£
```

---

## ğŸ”§ API æ¥å£æ›´æ–°

### æ–°å¢æ¥å£

#### `GET /api/stream_query`
**å‚æ•°ï¼š**
- `question` (query string) - ç”¨æˆ·é—®é¢˜

**è¿”å›ï¼š** Server-Sent Events æµ

**äº‹ä»¶ç±»å‹ï¼š**
- `start` - å¼€å§‹å¤„ç†
- `intent` - æ„å›¾è¯†åˆ«
- `retrieval` - æ£€ç´¢çŸ¥è¯†åº“
- `generating` - ç”Ÿæˆç­”æ¡ˆ
- `chunk` - ç­”æ¡ˆç‰‡æ®µï¼ˆæ‰“å­—æœºæ•ˆæœï¼‰
- `complete` - å®Œæˆï¼ˆåŒ…å«å®Œæ•´ç»“æœï¼‰
- `error` - é”™è¯¯ä¿¡æ¯

### æ›´æ–°æ¥å£

#### `POST /api/query`
**æ–°å¢è¿”å›å­—æ®µï¼š**
- `price_comparison` - ä»·æ ¼å¯¹æ¯”æ•°æ®
  ```json
  {
    "status": "success",
    "comparisons": [
      {
        "product": "å†°ç®±",
        "jd_price": 2999,
        "taobao_price": 2899,
        "best_platform": "taobao",
        "savings": 100,
        "url": "https://search.taobao.com/å†°ç®±"
      }
    ],
    "total_savings": 300
  }
  ```

---

## ğŸ¨ å‰ç«¯ç»„ä»¶æ›´æ–°

### Charts.jsx ç»„ä»¶ API

#### SubsidyPieChart
```jsx
<SubsidyPieChart recommendation={recommendation} />
```
**Props:**
- `recommendation` - æ¨èç»“æœå¯¹è±¡

#### PriceComparisonChart
```jsx
<PriceComparisonChart 
  recommendation={recommendation}
  priceComparison={priceComparison}
/>
```
**Props:**
- `recommendation` - æ¨èç»“æœ
- `priceComparison` - ä»·æ ¼å¯¹æ¯”æ•°æ®ï¼ˆå¯é€‰ï¼‰

#### UtilizationChart
```jsx
<UtilizationChart recommendation={recommendation} />
```
**Props:**
- `recommendation` - æ¨èç»“æœ

#### VisualizationPanelï¼ˆå®Œæ•´é¢æ¿ï¼‰
```jsx
<VisualizationPanel 
  recommendation={recommendation}
  priceComparison={priceComparison}
/>
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### æ’ä»¶ç³»ç»Ÿ
- åŠ¨æ€åŠ è½½ï¼ŒæŒ‰éœ€æ‰§è¡Œ
- å¼‚å¸¸éš”ç¦»ï¼Œä¸å½±å“ä¸»æµç¨‹
- DEBUG æ—¥å¿—è¾“å‡º

### æµå¼è¾“å‡º
- å¼‚æ­¥å¤„ç†ï¼Œä¸é˜»å¡
- çº¿ç¨‹æ± æ‰§è¡ŒåŒæ­¥ä»»åŠ¡
- æ¯10ä¸ªå­—ç¬¦å‘é€ä¸€æ¬¡ï¼ˆå¯è°ƒæ•´ï¼‰

### å›¾è¡¨æ¸²æŸ“
- Chart.js é«˜æ€§èƒ½æ¸²æŸ“
- å“åº”å¼å¸ƒå±€ï¼ˆmobile-firstï¼‰
- æ‡’åŠ è½½ï¼ˆä»…åœ¨æœ‰æ•°æ®æ—¶æ¸²æŸ“ï¼‰

---

## ğŸ“ ä¸‹ä¸€æ­¥å»ºè®®

### é«˜ä¼˜å…ˆçº§
1. âœ… æ’ä»¶ç³»ç»Ÿ - **å·²å®Œæˆ**
2. âœ… æµå¼è¾“å‡º - **å·²å®Œæˆ**
3. âœ… å›¾è¡¨å¯è§†åŒ– - **å·²å®Œæˆ**
4. ğŸ”² ç¼“å­˜ä¼˜åŒ–ï¼ˆRedisï¼‰
5. ğŸ”² å‰ç«¯æ¥å…¥æµå¼è¾“å‡º

### ä¸­ä¼˜å…ˆçº§
1. ğŸ”² OCR è¯†åˆ«æ’ä»¶
2. ğŸ”² è¯­éŸ³è¾“å…¥/è¾“å‡º
3. ğŸ”² PDF/Excel å¯¼å‡ºå®ç°
4. ğŸ”² ç”µå•†APIå¯¹æ¥ï¼ˆçœŸå®ä»·æ ¼ï¼‰

### ä½ä¼˜å…ˆçº§
1. ğŸ”² çŸ¥è¯†å›¾è°±
2. ğŸ”² ä¸»åŠ¨å­¦ä¹ ï¼ˆLoRAå¾®è°ƒï¼‰
3. ğŸ”² PWA ç§»åŠ¨ç«¯
4. ğŸ”² å¤šè¯­è¨€æ”¯æŒ

---

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡å‡çº§å®Œæˆäº†ä¸‰å¤§æ ¸å¿ƒåŠŸèƒ½ï¼š

1. **æ’ä»¶ç³»ç»Ÿ** - å¯æ‰©å±•æ¶æ„ï¼Œæ”¯æŒåŠ¨æ€æ’ä»¶
2. **æµå¼è¾“å‡º** - å®æ—¶åé¦ˆï¼Œæå‡ç”¨æˆ·ä½“éªŒ
3. **å›¾è¡¨å¯è§†åŒ–** - æ•°æ®æ´å¯Ÿï¼Œç›´è§‚å±•ç¤º

æ‰€æœ‰åŠŸèƒ½å·²å®Œæˆå¼€å‘ã€æµ‹è¯•å’Œé›†æˆï¼Œå¯ç«‹å³ä½¿ç”¨ï¼ ğŸš€
