# 项目启动指南

## 📋 环境要求

- **Python**: 3.8+
- **Node.js**: 14+ (仅用于构建前端)
- **操作系统**: Windows/Linux/macOS

---

## 🚀 快速启动（5步）

### 1️⃣ 安装 Python 依赖

```bash
cd E:\shensibeiai
pip install -r requirements.txt
```

**核心依赖包括：**
- `fastapi==0.104.1` - Web框架
- `chromadb==0.4.22` - 向量数据库
- `langchain==0.1.20` - RAG框架
- `rank-bm25` - BM25检索
- `jieba` - 中文分词

---

### 2️⃣ 配置 API 密钥

编辑 `config.py`，设置大模型API密钥：

```python
# 使用通义千问（推荐）
USE_OPENAI_COMPATIBLE = True
OPENAI_API_KEY = "sk-你的密钥"  # 替换为实际密钥
OPENAI_BASE_URL = "https://dashscope.aliyuncs.com/compatible-mode/v1"
OPENAI_MODEL = "qwen-plus"
```

**或使用百度千帆：**
```python
USE_QIANFAN = True
QIANFAN_AK = "your_api_key"
QIANFAN_SK = "your_secret_key"
```

---

### 3️⃣ 初始化知识库

```bash
python knowledge_base.py
```

**输出示例：**
```
加载了 7 个文档
切分成 38 个文本块
✓ BM25 索引构建完成
知识库构建完成！
```

---

### 4️⃣ 构建前端（首次运行）

```bash
cd intelli-policy
npm install
npm run build
```

**生成目录：** `intelli-policy/dist/`

---

### 5️⃣ 启动服务

```bash
cd E:\shensibeiai
python app.py
```

**访问地址：**
- 前端界面: http://localhost:8000
- API文档: http://localhost:8000/docs

---

## 📁 项目目录结构

```
E:\shensibeiai\
├── app.py                    # FastAPI 后端入口
├── config.py                 # 配置文件（需修改API密钥）
├── knowledge_base.py         # 知识库构建
├── agent.py                  # 智能体核心逻辑
├── tools.py                  # 工具链（推荐算法）
├── requirements.txt          # Python依赖
├── 市级消费活动政策/         # 政策文档源（DOCX/PDF）
├── chroma_db/                # 向量索引（自动生成）
├── intelli-policy/           # React前端项目
│   ├── src/App.jsx          # 前端主文件
│   ├── dist/                # 构建输出（需npm run build）
│   └── package.json
└── knowledge_base/
    └── metadata_kb/policy_registry.json  # 文档注册表
```

---

## ⚙️ 常见问题

### Q1: 提示"知识库未就绪"？
**原因：** 未运行知识库初始化

**解决：**
```bash
python knowledge_base.py
```

---

### Q2: 前端显示 404？
**原因：** 未构建前端或路径错误

**解决：**
```bash
cd intelli-policy
npm run build
```

确保生成 `intelli-policy/dist/` 目录

---

### Q3: API 返回 500 错误？
**原因：** API密钥未配置或无效

**检查：**
1. 打开 `config.py`
2. 确认 `OPENAI_API_KEY` 已正确设置
3. 测试密钥有效性

---

### Q4: BM25检索不可用？
**原因：** 缺少可选依赖

**解决：**
```bash
pip install rank-bm25 jieba
```

---

## 🔧 修改知识库数据源

如需使用其他政策文档：

1. 将文档放入指定目录（支持 PDF/DOCX）
2. 修改 `config.py`：
```python
DOCS_DIR = "./你的政策文件夹"
```

3. 重建知识库：
```bash
python knowledge_base.py
```

---

## 📊 功能模块

### 1. 政策问答
- 基于RAG的精准问答
- 自动标注政策出处
- 支持多轮对话

### 2. 补贴计算
- 工具链精确计算
- 零幻觉保证
- 支持多商品组合

### 3. 智能推荐
- 动态规划算法（全局最优）
- 自动生成最优换新方案
- 资金利用率最大化

### 4. 政策库
- 文档检索与浏览
- 按文档去重
- 相似度排序

---

## 🛠️ 技术栈

**后端：**
- FastAPI - Web框架
- ChromaDB - 向量数据库
- LangChain - RAG框架
- FAISS - 向量索引
- 通义千问/百度千帆 - LLM

**前端：**
- React + Vite
- Tailwind CSS
- Lucide Icons

---

## 📞 联系方式

如遇问题，请检查：
1. Python版本 >= 3.8
2. API密钥配置正确
3. 知识库已初始化
4. 前端已构建

**服务端口：** 8000  
**默认模型：** qwen-plus
